# 回测模式对比说明

## 两种运行模式

### 模式1️⃣：历史数据回测（main.py）⚡ 快速

**运行方式：**
```bash
python main.py
```

**工作原理：**
- 一次性获取**过去72小时**的历史数据
- 在历史数据上快速模拟交易
- **几分钟内**完成整个72小时的回测

**时间消耗：** 约 **3-5分钟**

**优点：**
- ✅ 快速验证策略
- ✅ 可以测试不同历史时间段
- ✅ 适合策略优化和参数调整
- ✅ 可以反复测试

**适用场景：**
- 策略验证和优化
- 参数调优
- 快速评估策略表现

---

### 模式2️⃣：实时模拟交易（live_simulator.py）⏰ 真实时间

**运行方式：**
```bash
python live_simulator.py
```

**工作原理：**
- 从**现在**开始，往后运行72小时
- 每1分钟拉取最新的实时数据
- 实时分析并执行交易决策

**时间消耗：** 真实的 **72小时（3天）**

**优点：**
- ✅ 真实市场环境测试
- ✅ 验证策略在实时数据上的表现
- ✅ 接近真实交易体验
- ✅ 每小时自动生成报告

**适用场景：**
- 策略最终验证
- 模拟盘测试
- 准备上线前的检验

---

## 对比表格

| 特性 | 历史回测 (main.py) | 实时模拟 (live_simulator.py) |
|------|-------------------|----------------------------|
| **运行时间** | 3-5分钟 | 真实72小时 |
| **数据来源** | 过去的历史数据 | 实时最新数据 |
| **适合快速测试** | ✅ 是 | ❌ 否 |
| **接近实盘** | 较远 | 很近 |
| **可重复测试** | ✅ 可以 | ❌ 不可以（每次市场不同） |
| **资源消耗** | 低 | 中（需持续运行） |

---

## 推荐使用流程

### 第一步：快速验证（历史回测）
```bash
# 使用历史数据快速测试策略
python main.py
```
**目的：** 验证策略基本逻辑，调整参数

### 第二步：优化参数（历史回测）
```bash
# 修改 config/config.yaml 中的参数
# 多次运行，找到最佳参数组合
python main.py
```
**目的：** 优化策略参数，提高胜率

### 第三步：实时验证（实时模拟）
```bash
# 使用优化后的参数进行实时模拟
python live_simulator.py --hours 24  # 先测试24小时
```
**目的：** 验证策略在真实市场的表现

### 第四步：完整测试（实时模拟）
```bash
# 完整的72小时实时测试
python live_simulator.py
```
**目的：** 最终验证，准备上线

---

## 实时模拟器特点

### 1. 持续运行
- 需要保持程序运行72小时
- 每分钟自动拉取最新数据
- 自动执行交易决策

### 2. 实时监控
```
时间: 2024-11-15 10:30:00, 价格: 50000.00 USDT
信号: BUY, 强度: 强
原因: RSI超卖反弹, KDJ超卖区金叉, 趋势向上
风险等级: 低
【买入】价格=50025.00, 数量=0.019000, 金额=950.48, 原因=..., 资金余额=49.52
```

### 3. 每小时报告
```
============================================================
第 1 小时报告
============================================================
已运行: 1.0 / 72 小时
总交易次数: 2
盈利次数: 1
亏损次数: 1
当前资金: 1005.50 USDT
总收益: 0.55%
最大回撤: 0.30%
============================================================
```

### 4. 优雅退出
按 `Ctrl+C` 可以随时停止，程序会：
- 自动平仓（如有持仓）
- 生成完整报告
- 保存所有数据

---

## 快速测试实时模拟

如果您想快速体验实时模拟，可以设置较短的时间：

```bash
# 只运行1小时（用于测试）
python live_simulator.py --hours 1

# 只运行6小时（半天）
python live_simulator.py --hours 6

# 只运行24小时（1天）
python live_simulator.py --hours 24
```

---

## 配置说明

两种模式使用相同的配置文件 `config/config.yaml`，主要区别：

**历史回测：**
```yaml
# 回测过去72小时的历史数据
hours: 72
```

**实时模拟：**
```yaml
# 从现在开始往后运行72小时
hours: 72
```

---

## 常见问题

### Q: 实时模拟可以暂停吗？
A: 可以按 `Ctrl+C` 停止，但无法暂停后继续。如需继续，需要重新开始。

### Q: 实时模拟期间电脑可以关机吗？
A: 不可以。程序需要持续运行。建议：
- 使用云服务器
- 使用不关机的电脑
- 或者先用历史回测验证策略

### Q: 两种模式的结果会一样吗？
A: 不会完全一样：
- 历史回测：测试的是过去的市场
- 实时模拟：测试的是未来的市场
- 市场条件不同，结果会有差异

### Q: 哪种模式更准确？
A:
- **历史回测**：适合评估策略在已知市场的表现
- **实时模拟**：适合评估策略在未知市场的表现
- 两者结合使用最佳

### Q: 实时模拟会真的交易吗？
A: **不会！** 这只是模拟，不会真实下单。所有交易都是虚拟的。

---

## 建议

1. **新手或快速测试**: 使用 `main.py` (历史回测)
2. **策略优化**: 使用 `main.py` 反复测试不同参数
3. **最终验证**: 使用 `live_simulator.py` 进行真实时间测试
4. **上线前检验**: 使用 `live_simulator.py` 运行完整72小时

---

**总结：**
- `main.py` = 快速回测 = 几分钟完成 = 测试历史
- `live_simulator.py` = 实时模拟 = 72小时完成 = 测试未来
